## Game On! - Pie Noon

![video_screenshot](images/0bqsCoOrlHY.jpg)

** 视频发布时间**
 
> 2015年2月25日

** 视频介绍**

> "Why did Google create a game about Pie Throwing? Find out how the team behind Pie Noon used WebP, MathFu, and FlatBuffers to buildtheirlatestAndroidgame. 

> Pie Noon: http://google.github.io/pienoon/ 

> WebP: https://developers.google.com/speed/webp/ 

> MathFu: http://google.github.io/mathfu/ 

> FlatBuffers: http://google.github.io/flatbuffers/ 

> Other utilities: http://google.github.io/fplutil/ 
 

** 视频推介语 **

>  暂无，待补充。


### 译者信息

| 翻译 | 润稿 | 终审 | 原始链接 | 中文字幕 |  翻译流水号  |  加入字幕组  |
| -- | -- | -- | -- | -- |  -- | -- | -- |
| 葛佳恒 | 贺颂 | -- | [ Youtube ]( https://www.youtube.com/watch?v=0bqsCoOrlHY )  |  [ Youtube ]( https://www.youtube.com/watch?v=YxJ6DxkRXOs&index=68&list=PLvivLNHqjoowK2IZ9j_NYIucUrGgdiDrT ) | 1503060393 | [ 加入 GDG 字幕组 ]( {{ book.host }}/join_translator )  |



### 解说词中文版：

卖烤箱手套了


烤箱手套


卖烤箱手套了


烤箱手套


哦


先生你好


我需要一只烤箱手套


实际上  我要买两只


拿去吧  孩子


好好享受


好的


谢谢你


这正是我所需要的


这是  呃


请问这是怎么回事


哦


那是我的发明  看见没有


传统的烤箱手套又大又笨


所以我在手套上剪了一个大开口


这样的话  你在使用手套的同时


仍然可以使用自己的手指


非常棒的点子  是吧


哇哦


这样好像非常危险


你自己试用过吗


还没有


我不算是厨师


我更像一位烤箱手套制作工


不管怎样  享受你的烤箱手套吧


卖烤箱手套了


烤箱手套


卖烤箱手套了


烤箱手套


卖烤箱手套了


嗯


也许我们可以从中学到一些东西


如果你一直在建造工具


但是从来都不用一下


你无法确定它们好不好


我先把它们扔到这儿


看见没有  我们在Google可不想落得和卖给朋友的烤箱手套一样的下场


所以  这也就间接解释了


为什么我们在Google应用商店里发布了一款


扔派的游戏


如果你还没玩过这款游戏的话  我来简单介绍一下


Pie Noon 是一款快节奏的动作游戏


在一场扔派大战中  你需要做好准备对抗你的朋友们



这款游戏是 Fund Propulsion Lab 团队开发的


他们也开发了例如 LiquidFun 的


物理引擎


这带来了一些重要的问题


比如为什么Google在做游戏


我们在创办一间游戏工作室吗


这个发展方向怎么样


好吧  其实不是这样的


对于初学者来说  盈利模式是很棘手的


我的意思是


负责微交易的同事在哪儿呢


玩笑而已


我们制作 Pie Noon 是因为我们已经为C++游戏开发者


制作了一些很棒的新工具


但是我们觉得也许现在应该把钱花在


我们的嘴上  尤其是它们还没有吃饱派的时候


同时展示一下在一个完整的游戏中如何使用这些


工具


然后我们可以开源这个项目


让你们看看我们是如何做到每一件事情的


那么让我们一个一个地过一遍我们使用的技术


首先是 WebP


WebP 是一种新的图片格式


它可以在不牺牲图片质量的前提下减小图片


大小


现在  有些人误以为WebP只是用于


网页的


也许是名字中的 web 单词误导了你


其实不是的


你也可以在移动应用中使用它


WebP 支持有损和无损压缩


以及两种压缩的无损 Alpha 透明


它在处理 JPEG 和 PNG 格式的图片时对文件大小的压缩


非常可观


记住  图片资源经常


会成为你的游戏中最大的部分


不是每个人都是通过4G网络把游戏下载到


一台32GB的设备上的


对于很多人来说  带宽和文件大小


依然是考虑的因素  你的游戏包越小


人们越可能安装它并且把它留在


他们的设备上


在 Pie Noon 中  我们的工程师先将目标文件


转换成PNG文件


然后再转换成WebP格式的文件


游戏中最终使用到的就是


这些转换后的文件


效果如何呢


一开始足足有42MB的目标文件变成了10.7MB


的PNG文件  最终又转换成了只有1.4MB的WebP文件


如果你好奇的话  我来详细讲一下  我们把有损的


图片质量设置为90%


这会在图片的大小和质量之间达到平衡


你可以自己在游戏中判断画面的质量


或者尝试一下我们的转换工具


看看什么样的选项最适合你


现在你仍然可以更进一步


使用GPU优化纹理导出文件


我们仍然强烈推荐这样做


但是我知道有些开发者不希望


根据不同的芯片组处理各种纹理格式


WebP 是这些人的福音


下面让我们说说 MathFu


MathFu 是一个跨平台的C++库


它可以快速简单地执行游戏开发者遇到的


常见的数学任务


所以如果你需要相乘矩阵


处理四元数  或者仅仅需要


一个随机生成的矢量  MathFu 都可以提供帮助


虽然有许多类似的数学库


但是将 MathFu 与另外的这些数学库区别开的


是下面两方面


首先  它为SIMD芯片做了优化


也许你手机中的芯片就是SIMD的


这非常重要


在Nexus 5上  你可以看到仅仅由于SIMD优化


就可以达到5倍的提速


而在桌面电脑上  提速可以达到20倍


第二点  MathFu从一开始就被设计得


简单而且合理


开发者不会像被扔进厨房水槽一样手忙脚乱


MathFu 会专注于执行游戏开发者


需要的任务


所以如果你想要一个数学库


来帮助你建立蛋白质模型或者类似的事情


你不应该使用MathFu


你能找到更适合的库


但是如果你想要开发一款游戏


MathFu 可以满足你所有的需求


而这正是 Pie Noon 这个团队想要


证明给大家看的


他们在很多地方都使用到了这个库


从粒子系统到相机定位


再到计算派的抛物线路径  MathFu都很好地完成了任务


最后  你的游戏中会有一大块JSON数据


用来存储玩家等级数据  动画文件


或者保存的游戏数据吗


如果你真这么做了  赶紧住手


我是认真的


住手


现在就住手


离文本编辑器远一点


你知道吗  虽然JSON在提供人类可读的数据方面做的很棒


但是为了达到人类可读的目的


你最后不得不使用比原本大得多的数据存储空间


而且在很多编程语言中


JSON的解析


会由于字符串解析和类型匹配工作


变得很慢


除了上面这个问题  反序列化的过程


很可能会破坏你的内存


因为很多临时对象在不停地分配内存和回收内存


为了修复这个问题  Google写了一个叫FlatBuffers的


序列化库


使用这个开源工具的时候  你只需要写出描述你的数据


的模式  FlatBuffers库就可以生成一个C++文件


它可以将一个字节数组转换成一个本地对象


反之亦然  你甚至都不需要打开字节数组


也就是说没有任何多余的对象被分配到


内存中


这样会比读取JSON文件快很多


它可以跨平台工作  它是强类型的


这样可以避免粗心导致的错误


它甚至支持版本升级


当你需要改变你的数据格式的时候可以用到


Pie Noon 团队使用FlatBuffers


定义所有的数据  从UI元素的位置


到它们的粒子效果  再到存储


所有的游戏设置


现在你要对我下面要说的做好心理准备


他们使用JSON文件定义这些数值


好吧  这个讨厌的警告标识


快走开


看这里


现在好了


你看这里有一个创建数据的中间步骤


使用一个FlatBuffer的模式和一个对应的JSON文件


将整个数据转化成一个字节数组


这个数组可以在游戏开始的时候被生成的C++文件


以一个本地对象快速地读取


如果你对更多的细节感兴趣的话


你可以查看一下项目中的CMakeLists文件


但是我觉得这里的重点是


这个团队使用FlatBuffers很方便地


既定义了人类可读的数据格式


也获得了接近本地代码的速度


从某种观点来说  这个提速非常之大


FlatBuffers比JSON要快400倍


但是看看实际的数字  其实并没有那么大的提升


因为这个游戏没有加载太多的数据


所以和游戏启动时其它所需要做的事情相比


这方面的提升非常有限


但是如果你的游戏恰好有大量的游戏数据


或者保存的文件  这可以为你节省很多启动时间


我们的团队还使用了一些其它技术


比如build_all_android.py脚本


它可以快速的遍历工程构建的信息


还有CPU分析器  坦白地讲


这个不是非常有用  因为游戏是和GPU绑定的


但是这又是另外一个话题了


总之  如果你想更深入地了解


这些技术


我们在下面的简介中有


各种相关的链接


更重要的是  我们提供了完整项目的链接


你可以下载了试试


探索一下代码


构建你自己的 Pie Noon


所以赶紧去试试吧


对于我来说  我要来尝尝这个新鲜出炉的派了


天啊  烫死我了


哇哦


哇哦


就像我说的  你可以一直创造工具


但是除非你自己亲自试用过它们


否则你可能会被烫伤  真的烫伤


我是 Todd Kerpelman  下次再见


你知道我为什么喜欢在Google工作吗


因为每一天都是不一样的


每一天都有新的挑战和惊喜



就像这样


大家把手机调成静音


反正也没人打电话给我


有电话


肯定是打错了


我让他们和我聊聊的




我就是想问问


这个闻起来如何


什么


我觉得它闻起来不错


怎么了



我恨你 Jeff





