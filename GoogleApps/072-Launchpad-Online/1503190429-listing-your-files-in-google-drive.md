## Listing your files in Google Drive

![video_screenshot](images/Z5G0luBohCg.jpg)

** 视频发布时间**
 
> 2014年11月13日

** 视频介绍**

> This episode walks you through the few lines of code needed to list your files & folders in Google Drive.

** 视频推介语 **

>  暂无，待补充。


### 译者信息

| 翻译 | 润稿 | 终审 | 原始链接 | 中文字幕 |  翻译流水号  |  加入字幕组  |
| -- | -- | -- | -- | -- |  -- | -- | -- |
| 虎子 | 葛佳恒 | -- | [ Youtube ]( https://www.youtube.com/watch?v=Z5G0luBohCg )  |  [ Youtube ]( https://www.youtube.com/watch?v=H0LZSZ9ihfw ) | 1503190429 | [ 加入 GDG 字幕组 ]( {{ book.host }}/join_translator )  |



### 解说词中文版：

嘿 大家好

我是Wesley Chun 谷歌的工程师和开发者大使

在这段视频里 我们将完成一个能够

列举你在Google Drive上的文件的脚本

但是在开始之前 为什么要使用Drive的API

我们不是在讨论如何在Google Apps  文件同步

或者是用户界面集成方面使用Drive SDK

不是的

Drive API可以解放Drive的功能

为你的App所用

例如上传和下载文件  分享  文件夹组织

元数据  以及版本控制

通过这个API  你能写一个可以

解压文档  并且上传这些文件到Google Drive

的应用

或者是把Drive上的一系列照片做成一两张拼贴图

再将生成的图片上传备份到Drive

等等  有一个更棒的想法

好吧  你们中有多少人在不同的时间和地方拍过

大量的照片呢

整理这些照片真令人头疼

喔  如果你能够写上几行代码  让它们

能够使用每一个图片文件中的时间戳和

嵌入的地理位置信息

从数以千计的杂乱的照片中

自动创建照片专辑难道不可能吗

恩  只要有我们的API  这一切都有可能

我们今天要写的代码只是一个开端

这是你的起点

我们将用python来写

但是你可以使用任何

被谷歌API的客户端库所支持的语言来写

因为各种语言的调用是类似的

当使用Google API  有些情况需要认证

有些情况则不需要

例如  普通的YouTube视频的搜索

就不需要认证  但是接入Google Drive

和更新你的YouTube播放列表

就需要  因为这是私人数据

两种情况都有一些示例代码

挑选合适的使用吧

对我们来说  因为今天我们要和Drive打交道

你将会使用需要认证的代码

如果你没有学过的话  可以点击链接看看

之前的关于这个话题的教程

现在我们正在看代码  来  让我们

去电脑上写脚本吧


在之前的课程中  我们看过实现认证的

访问Google API数据的模板代码

对于需要认证的API请求

代码基本都是相似或者完全一样的

所以你应该写的很爽

今天我们将使用Google Drive API

所以一开始我们将把模板代码粘贴到这儿  存作drivelist.py

你随便怎么取名字都行

在本次的课程中  我们想列举出我们在Drive文件夹中的文件

这是用户数据  所以需要认证

你无法仅仅通过一个API key就获得这类数据

在import语句下面  你要做的第一件事就是

在第五行声明SCOPES变量

取决于你想干嘛

你可能需要一个或者更多的权限值

所以要么定义一串字符串

或者是一个以空格分隔的包含多个权限值的长字符串

我们唯一需要的权限就是drive.readonly

这也是我们定义的SCOPES变量的全部值

你能从API页面或者OAuth Playground中

获取权限的列表

第六行是一个客户端的秘密文件

在你点击项目认证页面上的Download JSON按钮时会

保存这个文件

当应用被授予访问权限以后

你会收到一个访问令牌

它会被保存在第八行代码中的文件里

因为我们即将第一次运行这个脚本

我们没有任何凭证  这意味着

代码无法通过第十行的if判断语句

里面的代码是用于进行OAuth授权流程的

一旦访问被授权  我们需要创建一个服务端点

这在14行里有

这个API字符串参数就是drive  因为

这就是我们将要访问的API

这个API目前更新至第2版

所以我们将VERSION参数设置为v2

最后一个参数是使用我们的凭证

去签名我们的HTTP请求

一旦所有东西都正常执行了

那我们现在就会有一个服务端点去访问Google Drive了

我们想要拉取一个用户的文件

那么我们先来创建一个files变量吧

恩 我们将用一个服务端点去进行访问

我们将会调用files()方法进行文件访问

然后我们会使用list()方法去获取文件列表

然后要执行execute()方法

如果前面都没错的话  我们将获得一个返回的payload对象

它里面有一个items成员变量

但是以防万一  我们会提供一个空列表参数  这样我们下面的

for循环就不会崩溃

现在我们想要迭代每一个文件

对于files里的每一个文件  我们要怎么做呢

我将会展示文件名

这个通过title字段可以获取

我们也会展示它的类型

这由mimeType字段定义

基本上就是这样了

代码应该可以运行了

所以让我们在这的命令行窗口试试看

对了  如果你想知道你还能从API里获得哪些数据

看看文档就知道了

现在来运行一下吧

通过OAuth授权流程  获取凭证

再查看一些Drive中的文件

顺便说一下  在我运行之前

这时会有提示

tools的run()方法已经被废弃了

的确如此

有一个更新的叫runFlow()的方法

但是在Python环境下  这个需要额外的编码

我们会在另外的课程中看看这些变化

我们暂时还是使用tools.run()方法

它勉强还能用

很多代码里还会用到它

但是它早晚会被代替的

运行这个命令时

我们能看到浏览器的弹窗进行OAuth授权的流程

你可以在这里看到弹窗

现在如果你没有看到一个OAuth授权的窗口

而是看到了一个写着401错误的页面

上面说你缺少应用名称或者Email

先找到项目许可页面

填完刚才的两项  其他项都是可选的

并且记得保存

现在你就可以看到和这个一样的页面了

一旦用户通过授权  一个有效的访问令牌会发送回来

并且存在storage.json文件中  这是代码8到12行做的事情

然后就开始执行下面的代码

我们应该可以看到很多Drive文件出现在这里

看啊  果然如此

好了

不到20行代码就可以访问你的Drive文件了

当然  这才刚开始而已

你想过做移动端程序吗

对  Drive具有针对Android和iOS的API

去看开发者文档  你会找到更多信息

好了  我们希望以上这些能对你有些启发

让你更好地使用Google Drive进行开发

我是Google的Wesley Chun  希望下次我们依然能在

Launch Pad见面